---
import Layout from '../layouts/Layout.astro';
import data from '../data/data.json';

// Extrae los parámetros de la URL de forma segura
const category = Astro.params.category;
const subcategory = Astro.params.subcategory;
const productSlug = Astro.params.product;

if (!category || !subcategory || !productSlug) {
  throw new Error("Parámetros 'category', 'subcategory' o 'product' no proporcionados en la URL.");
}

// Encuentra la categoría y subcategoría correspondiente en los datos JSON
const categoryData = data.categories.find((cat) => cat.name.toLowerCase() === category.toLowerCase());
if (!categoryData) {
  throw new Error(`Categoría "${category}" no encontrada`);
}

const subcategoryData = categoryData.subcategories.find((sub) => sub.name.toLowerCase() === subcategory.toLowerCase());
if (!subcategoryData) {
  throw new Error(`Subcategoría "${subcategory}" no encontrada`);
}

// Encuentra el producto correspondiente en la subcategoría
const productData = subcategoryData.products.find((prod) => prod.name.toLowerCase() === productSlug.toLowerCase());
if (!productData) {
  throw new Error(`Producto "${productSlug}" no encontrado`);
}
---

<Layout title={`Producto: ${productData.name}`}>
  <!-- Encabezado del producto -->
  <header style="background-color: ${subcategoryData.color}; padding: 2rem; text-align: center; color: white;">
    <h1 style="font-size: 2.5rem; font-weight: bold; margin-bottom: 0.5rem;">{productData.name}</h1>
  </header>

  <!-- Contenedor principal del producto -->
  <section style="display: flex; justify-content: center; align-items: flex-start; padding: 2rem; max-width: 1200px; margin: auto;">
    <!-- Columna de detalles del producto -->
    <div style="flex: 1; margin-right: 2rem; border: 1px solid #ccc; border-radius: 8px; padding: 1rem;">
      <h2 style="font-size: 1.5rem; font-weight: bold;">{productData.name}</h2>
      <hr style="margin: 1rem 0;" />
      <p style="font-size: 1rem; color: #555;">{productData.description}</p>
      <hr style="margin: 1rem 0;" />
      <h3 style="font-size: 1.2rem; font-weight: bold;">Ingredientes</h3>
      <p style="font-size: 1rem; color: #555;">{productData.ingredients}</p>
      <hr style="margin: 1rem 0;" />
      <h3 style="font-size: 1.2rem; font-weight: bold;">Características</h3>
      <ul style="font-size: 1rem; color: #555;">
        {productData.bullets.map((bullet) => (
          <li>{bullet}</li>
        ))}
      </ul>
    </div>

    <!-- Columna de imagen del producto -->
    <div style="flex: 1; display: flex; justify-content: center; align-items: center; border: 1px solid #ccc; border-radius: 8px;">
      <img src={`https://imagedelivery.net/igeTCv6NpihMSigS0bbQIQ/${productData.image}/public`} alt={productData.name} style="max-width: 100%; height: auto; border-radius: 8px;" />
    </div>
  </section>

  <!-- Navegación de botones -->
  <div style="display: flex; justify-content: center; margin-top: 2rem;">
    <a href={`/categoria/${category.toLowerCase()}/${subcategory.toLowerCase()}`} style="margin: 0 40px;">
      <img src="https://imagedelivery.net/igeTCv6NpihMSigS0bbQIQ/67bb6f2c-4b78-4552-ff1a-259601741900/public" alt="Regresar" style="width: 50px; height: auto;" />
    </a>
    <a href="/" style="margin: 0 40px;">
      <img src="https://imagedelivery.net/igeTCv6NpihMSigS0bbQIQ/5825f952-6751-4012-b299-eaf994106600/public" alt="Inicio" style="width: 50px; height: auto;" />
    </a>
  </div>
</Layout>
