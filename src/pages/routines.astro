---
import Layout from '../layouts/Layout.astro';
import Card from '../components/Card.astro';
import data from '../data/data.json';

// Definición de productos para cada sección
const rutinaPielJoven = [
  { subcategory: 'dermopure', index: 1 },
  { subcategory: 'hyaluron-filler + 3x effect', index: 10 },
  { subcategory: 'hyaluron-filler + 3x effect', index: [4, 1] }, // Agrupados para "HIDRATA"
  { subcategory: 'faciales', index: 3, category: 'fotoprotección' }
];

const rutinaPielMadura = [
  { subcategory: 'dermatoclean', index: 0 },
  { subcategory: 'hyaluron-filler + 3x effect', index: 10 },
  { subcategory: 'hyaluron filler + elasticity', index: [0, 1] }, // Agrupados para "HIDRATA"
  { subcategory: 'faciales', index: 1, category: 'fotoprotección' }
];

// Función para obtener el producto y el color de la subcategoría
function getProduct(subcategoryName: string, index: number | number[], categoryName = 'faciales') {
  const category = data.categories.find(cat => cat.name.toLowerCase() === categoryName.toLowerCase());
  if (!category) return null;

  const subcategory = category.subcategories.find(sub => sub.name.toLowerCase() === subcategoryName.toLowerCase());
  if (!subcategory) return null;

  if (Array.isArray(index)) {
    return index
      .map(idx => subcategory.products.find(prod => prod.index === idx))
      .filter(Boolean)
      .map(product => ({ ...product, color: subcategory.color }));
  }

  const product = subcategory.products.find(prod => prod.index === index);
  return product ? { ...product, color: subcategory.color } : null;
}
---

<Layout title="Rutina Ideal Antiedad">
    <main class="mx-auto" style="width: 100%; margin-bottom: 40px;">
      <!-- Título principal -->
      <h1 class="text-3xl font-bold text-center mb-8" style="color: white; background-color: #878C92;">RUTINA IDEAL ANTIEDAD</h1>
  
      <!-- Rutina Piel Joven -->
      <section class="mb-16" style="display: flex; flex-direction: column; align-items: center;">
        <h2 class="text-xl font-bold text-center py-2 px-10 rounded-lg" style="color: white; background-color: #A70532; margin: 0 auto;">
          PIEL JOVEN
        </h2>
        <div class="flex flex-wrap justify-center gap-4 mt-6" style="width: 100%;">
          {rutinaPielJoven.map((item, index) => {
            const productData = getProduct(item.subcategory, item.index, item.category);
            if (!productData) return null;
  
            return (
              <div class="p-2 bg-white rounded-lg shadow-md flex flex-col items-center" style={Array.isArray(productData) ? 'width: auto;' : 'width: auto;'}>
                <h3 class="text-center font-semibold mb-2" style="color: #223341;">
                  {index === 0 ? 'LIMPIEZA' : index === 1 ? 'TRATAMIENTO' : index === 2 ? 'HIDRATACIÓN' : 'PROTECCIÓN'}
                </h3>
                {Array.isArray(productData) ? (
                  <div class="flex flex-row items-center justify-center gap-2">
                    {productData.map(product => (
                      product && (
                        <a href={`/categoria/${item.category ? item.category.toLowerCase() : 'faciales'}/${item.subcategory.toLowerCase()}/${product.index}`}>
                          <Card
                            img={`https://imagedelivery.net/igeTCv6NpihMSigS0bbQIQ/${product.image}/public`}
                            name={product.name}
                            color={product.color}
                            width="250px"
                            height="460px"
                            maxHeight="290px"
                          />
                        </a>
                      )
                    ))}
                  </div>
                ) : (
                  <a href={`/categoria/${item.category ? item.category.toLowerCase() : 'faciales'}/${item.subcategory.toLowerCase()}/${productData.index}`}>
                    <Card
                      img={`https://imagedelivery.net/igeTCv6NpihMSigS0bbQIQ/${productData.image}/public`}
                      name={productData.name}
                      color={productData.color}
                      width="250px"
                      height="460px"
                      maxHeight="290px"
                    />
                  </a>
                )}
              </div>
            );
          })}
        </div>
      </section>
  
      <!-- Rutina Piel Madura -->
      <section style="display: flex; flex-direction: column; align-items: center;">
        <h2 class="text-xl font-bold text-center py-2 px-10 rounded-lg" style="color: white; background-color: #A70532; margin: 0 auto;">
          PIEL MADURA
        </h2>
        <div class="flex flex-wrap justify-center gap-4 mt-6" style="width: 100%;">
          {rutinaPielMadura.map((item, index) => {
            const productData = getProduct(item.subcategory, item.index, item.category);
            if (!productData) return null;
  
            return (
              <div class="p-2 bg-white rounded-lg shadow-md flex flex-col items-center">
                <h3 class="text-center font-semibold mb-2" style="color: #223341;">
                  {index === 0 ? 'LIMPIEZA' : index === 1 ? 'TRATAMIENTO' : index === 2 ? 'HIDRATACIÓN' : 'PROTECCIÓN'}
                </h3>
                {Array.isArray(productData) ? (
                  <div class="flex flex-row items-center justify-center gap-2">
                    {productData.map(product => (
                      product && (
                        <a href={`/categoria/${item.category ? item.category.toLowerCase() : 'faciales'}/${item.subcategory.toLowerCase()}/${product.index}`}>
                          <Card
                            img={`https://imagedelivery.net/igeTCv6NpihMSigS0bbQIQ/${product.image}/public`}
                            name={product.name}
                            color={product.color}
                            width="250px"
                            height="460px"
                            maxHeight="290px"
                          />
                        </a>
                      )
                    ))}
                  </div>
                ) : (
                  <a href={`/categoria/${item.category ? item.category.toLowerCase() : 'faciales'}/${item.subcategory.toLowerCase()}/${productData.index}`}>
                    <Card
                      img={`https://imagedelivery.net/igeTCv6NpihMSigS0bbQIQ/${productData.image}/public`}
                      name={productData.name}
                      color={productData.color}
                      width="250px"
                      height="460px"
                      maxHeight="290px"
                    />
                  </a>
                )}
              </div>
            );
          })}
        </div>
      </section>
    </main>
    <!-- Navegación de botones -->
  <div style="display: flex; justify-content: center; margin: 10px 0 40px 0;">
    <!-- Botón para regresar a la página de subcategoría -->
    <a href="/" style="margin: 0 40px;">
      <img src="https://imagedelivery.net/igeTCv6NpihMSigS0bbQIQ/67bb6f2c-4b78-4552-ff1a-259601741900/public" alt="Regresar" style="width: 50px; height: auto;" />
    </a>
    <!-- Botón para regresar a la página de inicio -->
    <a href="/" style="margin: 0 40px;">
      <img src="https://imagedelivery.net/igeTCv6NpihMSigS0bbQIQ/5825f952-6751-4012-b299-eaf994106600/public" alt="Inicio" style="width: 50px; height: auto;" />
    </a>
  </div>
  </Layout> 